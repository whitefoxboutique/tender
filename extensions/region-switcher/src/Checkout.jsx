import {
  reactExtension,
  useCartLines,
  useApi,
  useSettings,
  Image,
  InlineLayout,
  Pressable,
  TextBlock,
  BlockStack,
  Heading,
  View,
  Text,
} from "@shopify/ui-extensions-react/checkout";

import { useEffect, useState } from 'react';

const SWITCHER_OPTIONS = [
  {
    name: 'AUS & NZ',
    domain: 'whitefoxboutique.com.au',
    params: { currency: 'AUD' },
    icon: 'data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDUxMiA1MTIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxwYXRoIGQ9Ik01MTIsMjU2YzAsMTQxLjM4NC0xMTQuNjE2LDI1Ni0yNTYsMjU2UzAsMzk3LjM4NCwwLDI1NkMwLDI1Ni4wNiwyNTYsMC4wMjksMjU2LDAKCUMzOTcuMzg0LDAsNTEyLDExNC42MTYsNTEyLDI1NnoiIHN0eWxlPSJmaWxsOiByZ2IoMCwgODIsIDE4MCk7Ij48L3BhdGg+IDxnPjxwYXRoIGQ9Ik0yNTYsMGMtMC4wMTQsMC0wLjAyOSwwLjAwMS0wLjA0MywwLjAwMUwyNTYsMEwyNTYsMHoiIHN0eWxlPSJmaWxsOiByZ2IoMjQwLCAyNDAsIDI0MCk7Ij48L3BhdGg+IDxwYXRoIGQ9Ik0yNTUuMzE1LDI1NkgyNTZjMC0wLjIzMiwwLTAuNDU0LDAtMC42ODVDMjU1Ljc3MiwyNTUuNTQ0LDI1NS41NDQsMjU1Ljc3MiwyNTUuMzE1LDI1NnoiIHN0eWxlPSJmaWxsOiByZ2IoMjQwLCAyNDAsIDI0MCk7Ij48L3BhdGg+IDxwYXRoIGQ9Ik0yNTYsMTMzLjU2NmMwLTQ1LjA0NSwwLTc0LjU2MiwwLTEzMy41NjVoLTAuMDQzQzExNC41OTIsMC4wMjQsMCwxMTQuNjI5LDAsMjU2aDEzMy41NjV2LTc1LjIxMgoJCUwyMDguNzc3LDI1Nmg0Ni41MzljMC4yMjktMC4yMjgsMC40NTctMC40NTYsMC42ODUtMC42ODVjMC0xNy4yNDcsMC0zMi42MzYsMC00Ni41MzZsLTc1LjIxMy03NS4yMTNIMjU2eiIgc3R5bGU9ImZpbGw6IHJnYigyNDAsIDI0MCwgMjQwKTsiPjwvcGF0aD48L2c+IDxnPjxwYXRoIGQ9Ik0xMjkuNTE1LDMzLjM5MUM4OS40NzYsNTYuMTksNTYuMTksODkuNDc2LDMzLjM5MSwxMjkuNTE1VjI1Nmg2Ni43ODNWMTAwLjE3NXYtMC4wMDFIMjU2CgkJYzAtMjEuMDYzLDAtNDEuMTI5LDAtNjYuNzgzSDEyOS41MTV6IiBzdHlsZT0iZmlsbDogcmdiKDIxNiwgMCwgMzkpOyI+PC9wYXRoPiA8cGF0aCBkPSJNMjU2LDIyNC41MTlsLTkwLjk1My05MC45NTJoLTMxLjQ4MWMwLTAuMDAxLDAsMCwwLDBMMjU1Ljk5OSwyNTZIMjU2CgkJQzI1NiwyNTYsMjU2LDIzNC4yOTUsMjU2LDIyNC41MTl6IiBzdHlsZT0iZmlsbDogcmdiKDIxNiwgMCwgMzkpOyI+PC9wYXRoPjwvZz4gPGc+PHBvbHlnb24gcG9pbnRzPSIxNTQuMzk1LDMwMC41MjIgMTY4LjQ0NSwzMjkuOSAyMDAuMTcyLDMyMi41NjcgMTg1Ljk2NCwzNTEuODY5IDIxMS40NzgsMzcyLjEwMiAKCQkxNzkuNzExLDM3OS4yNjIgMTc5LjgsNDExLjgyNiAxNTQuMzk1LDM5MS40NTMgMTI4Ljk5MSw0MTEuODI2IDEyOS4wOCwzNzkuMjYyIDk3LjMxMiwzNzIuMTAyIDEyMi44MjcsMzUxLjg2OSAxMDguNjE3LDMyMi41NjcgCgkJMTQwLjM0NiwzMjkuOSAJIiBzdHlsZT0iZmlsbDogcmdiKDI0MCwgMjQwLCAyNDApOyI+PC9wb2x5Z29uPiA8cG9seWdvbiBwb2ludHM9IjM4My4yODQsMzU2LjE3NCAzOTAuMzA5LDM3MC44NjMgNDA2LjE3MywzNjcuMTk2IDM5OS4wNjgsMzgxLjg0NyA0MTEuODI2LDM5MS45NjQgCgkJMzk1Ljk0MiwzOTUuNTQ0IDM5NS45ODYsNDExLjgyNiAzODMuMjg0LDQwMS42MzkgMzcwLjU4Miw0MTEuODI2IDM3MC42MjYsMzk1LjU0NCAzNTQuNzQzLDM5MS45NjQgMzY3LjUsMzgxLjg0NyAzNjAuMzk2LDM2Ny4xOTYgCgkJMzc2LjI1OSwzNzAuODYzIAkiIHN0eWxlPSJmaWxsOiByZ2IoMjQwLCAyNDAsIDI0MCk7Ij48L3BvbHlnb24+IDxwb2x5Z29uIHBvaW50cz0iMzE3LjkzMywyMDAuMzQ4IDMyNC45NTcsMjE1LjAzOCAzNDAuODIxLDIxMS4zNyAzMzMuNzE3LDIyNi4wMjEgMzQ2LjQ3NCwyMzYuMTM4IAoJCTMzMC41OTEsMjM5LjcxOCAzMzAuNjM0LDI1NiAzMTcuOTMzLDI0NS44MTMgMzA1LjIzMSwyNTYgMzA1LjI3NCwyMzkuNzE4IDI4OS4zOTEsMjM2LjEzOCAzMDIuMTQ4LDIyNi4wMjEgMjk1LjA0NCwyMTEuMzcgCgkJMzEwLjkwOCwyMTUuMDM4IAkiIHN0eWxlPSJmaWxsOiByZ2IoMjQwLCAyNDAsIDI0MCk7Ij48L3BvbHlnb24+IDxwb2x5Z29uIHBvaW50cz0iMzgzLjI4NCwxMTEuMzA0IDM5MC4zMDksMTI1Ljk5NCA0MDYuMTczLDEyMi4zMjcgMzk5LjA2OSwxMzYuOTc4IDQxMS44MjUsMTQ3LjA5NCAKCQkzOTUuOTQyLDE1MC42NzUgMzk1Ljk4NiwxNjYuOTU3IDM4My4yODQsMTU2Ljc3IDM3MC41ODIsMTY2Ljk1NyAzNzAuNjI2LDE1MC42NzUgMzU0Ljc0MywxNDcuMDk0IDM2Ny40OTksMTM2Ljk3OCAKCQkzNjAuMzk2LDEyMi4zMjcgMzc2LjI1OSwxMjUuOTk0IAkiIHN0eWxlPSJmaWxsOiByZ2IoMjQwLCAyNDAsIDI0MCk7Ij48L3BvbHlnb24+IDxwb2x5Z29uIHBvaW50cz0iNDQwLjM2OCwxNzguMDg3IDQ0Ny4zOTIsMTkyLjc3NyA0NjMuMjU2LDE4OS4xMDkgNDU2LjE1MiwyMDMuNzYgNDY4LjkwOSwyMTMuODc3IAoJCTQ1My4wMjUsMjE3LjQ1OCA0NTMuMDY5LDIzMy43MzkgNDQwLjM2OCwyMjMuNTUzIDQyNy42NjYsMjMzLjczOSA0MjcuNzA5LDIxNy40NTggNDExLjgyNiwyMTMuODc3IDQyNC41ODMsMjAzLjc2IAoJCTQxNy40NzksMTg5LjEwOSA0MzMuMzQyLDE5Mi43NzcgCSIgc3R5bGU9ImZpbGw6IHJnYigyNDAsIDI0MCwgMjQwKTsiPjwvcG9seWdvbj4gPHBvbHlnb24gcG9pbnRzPSIzOTkuNTUsMjU2IDQwNS4wNzUsMjczLjAwNiA0MjIuOTU3LDI3My4wMDYgNDA4LjQ5LDI4My41MTcgNDE0LjAxNywzMDAuNTIyIAoJCTM5OS41NSwyOTAuMDEyIDM4NS4wODQsMzAwLjUyMiAzOTAuNjA5LDI4My41MTcgMzc2LjE0MywyNzMuMDA2IDM5NC4wMjQsMjczLjAwNiAJIiBzdHlsZT0iZmlsbDogcmdiKDI0MCwgMjQwLCAyNDApOyI+PC9wb2x5Z29uPjwvZz4gPGc+PC9nPiA8Zz48L2c+IDxnPjwvZz4gPGc+PC9nPiA8Zz48L2c+IDxnPjwvZz4gPGc+PC9nPiA8Zz48L2c+IDxnPjwvZz4gPGc+PC9nPiA8Zz48L2c+IDxnPjwvZz4gPGc+PC9nPiA8Zz48L2c+IDxnPjwvZz48L3N2Zz4=',
    store: 'AU',
  },
  {
    name: 'USA, CAD, MEX',
    domain: 'whitefoxboutique.com',
    params: { currency: 'USD' },
    icon: 'data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDUxMiA1MTIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMjU2IiBzdHlsZT0iZmlsbDogcmdiKDI0MCwgMjQwLCAyNDApOyI+PC9jaXJjbGU+IDxnPjxwYXRoIGQ9Ik0yNDQuODcsMjU2SDUxMmMwLTIzLjEwNi0zLjA4LTQ1LjQ5LTguODE5LTY2Ljc4M0gyNDQuODdWMjU2eiIgc3R5bGU9ImZpbGw6IHJnYigyMTYsIDAsIDM5KTsiPjwvcGF0aD4gPHBhdGggZD0iTTI0NC44NywxMjIuNDM1aDIyOS41NTZjLTE1LjY3MS0yNS41NzItMzUuNzA4LTQ4LjE3NS01OS4wNy02Ni43ODNIMjQ0Ljg3VjEyMi40MzV6IiBzdHlsZT0iZmlsbDogcmdiKDIxNiwgMCwgMzkpOyI+PC9wYXRoPiA8cGF0aCBkPSJNMjU2LDUxMmM2MC4yNDksMCwxMTUuNjI2LTIwLjgyNCwxNTkuMzU2LTU1LjY1Mkg5Ni42NDRDMTQwLjM3NCw0OTEuMTc2LDE5NS43NTEsNTEyLDI1Niw1MTJ6IiBzdHlsZT0iZmlsbDogcmdiKDIxNiwgMCwgMzkpOyI+PC9wYXRoPiA8cGF0aCBkPSJNMzcuNTc0LDM4OS41NjVoNDM2Ljg1MmMxMi41ODEtMjAuNTI5LDIyLjMzOC00Mi45NjksMjguNzU1LTY2Ljc4M0g4LjgxOQoJCUMxNS4yMzYsMzQ2LjU5NiwyNC45OTMsMzY5LjAzNiwzNy41NzQsMzg5LjU2NXoiIHN0eWxlPSJmaWxsOiByZ2IoMjE2LCAwLCAzOSk7Ij48L3BhdGg+PC9nPiA8cGF0aCBkPSJNMTE4LjU4NCwzOS45NzhoMjMuMzI5bC0yMS43LDE1Ljc2NWw4LjI4OSwyNS41MDlsLTIxLjY5OS0xNS43NjVMODUuMTA0LDgxLjI1Mmw3LjE2LTIyLjAzNwoJQzczLjE1OCw3NS4xMyw1Ni40MTIsOTMuNzc2LDQyLjYxMiwxMTQuNTUyaDcuNDc1bC0xMy44MTMsMTAuMDM1Yy0yLjE1MiwzLjU5LTQuMjE2LDcuMjM3LTYuMTk0LDEwLjkzOGw2LjU5NiwyMC4zMDFsLTEyLjMwNi04Ljk0MQoJYy0zLjA1OSw2LjQ4MS01Ljg1NywxMy4xMDgtOC4zNzIsMTkuODczbDcuMjY3LDIyLjM2OGgyNi44MjJsLTIxLjcsMTUuNzY1bDguMjg5LDI1LjUwOWwtMjEuNjk5LTE1Ljc2NWwtMTIuOTk4LDkuNDQ0CglDMC42NzgsMjM0LjUzNywwLDI0NS4xODksMCwyNTZoMjU2YzAtMTQxLjM4NCwwLTE1OC4wNTIsMC0yNTZDMjA1LjQyOCwwLDE1OC4yODUsMTQuNjcsMTE4LjU4NCwzOS45Nzh6IE0xMjguNTAyLDIzMC40CglsLTIxLjY5OS0xNS43NjVMODUuMTA0LDIzMC40bDguMjg5LTI1LjUwOWwtMjEuNy0xNS43NjVoMjYuODIybDguMjg4LTI1LjUwOWw4LjI4OCwyNS41MDloMjYuODIybC0yMS43LDE1Ljc2NUwxMjguNTAyLDIzMC40egoJIE0xMjAuMjEzLDEzMC4zMTdsOC4yODksMjUuNTA5bC0yMS42OTktMTUuNzY1bC0yMS42OTksMTUuNzY1bDguMjg5LTI1LjUwOWwtMjEuNy0xNS43NjVoMjYuODIybDguMjg4LTI1LjUwOWw4LjI4OCwyNS41MDloMjYuODIyCglMMTIwLjIxMywxMzAuMzE3eiBNMjIwLjMyOCwyMzAuNGwtMjEuNjk5LTE1Ljc2NUwxNzYuOTMsMjMwLjRsOC4yODktMjUuNTA5bC0yMS43LTE1Ljc2NWgyNi44MjJsOC4yODgtMjUuNTA5bDguMjg4LDI1LjUwOWgyNi44MjIKCWwtMjEuNywxNS43NjVMMjIwLjMyOCwyMzAuNHogTTIxMi4wMzksMTMwLjMxN2w4LjI4OSwyNS41MDlsLTIxLjY5OS0xNS43NjVsLTIxLjY5OSwxNS43NjVsOC4yODktMjUuNTA5bC0yMS43LTE1Ljc2NWgyNi44MjIKCWw4LjI4OC0yNS41MDlsOC4yODgsMjUuNTA5aDI2LjgyMkwyMTIuMDM5LDEzMC4zMTd6IE0yMTIuMDM5LDU1Ljc0M2w4LjI4OSwyNS41MDlsLTIxLjY5OS0xNS43NjVMMTc2LjkzLDgxLjI1Mmw4LjI4OS0yNS41MDkKCWwtMjEuNy0xNS43NjVoMjYuODIybDguMjg4LTI1LjUwOWw4LjI4OCwyNS41MDloMjYuODIyTDIxMi4wMzksNTUuNzQzeiIgc3R5bGU9ImZpbGw6IHJnYigwLCA4MiwgMTgwKTsiPjwvcGF0aD4gPGc+PC9nPiA8Zz48L2c+IDxnPjwvZz4gPGc+PC9nPiA8Zz48L2c+IDxnPjwvZz4gPGc+PC9nPiA8Zz48L2c+IDxnPjwvZz4gPGc+PC9nPiA8Zz48L2c+IDxnPjwvZz4gPGc+PC9nPiA8Zz48L2c+IDxnPjwvZz48L3N2Zz4=',
    store: 'US',
  },
  {
    name: 'UK',
    domain: 'whitefoxboutique.co.uk',
    params: { currency: 'GBP' },
    icon: 'data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDUxMiA1MTIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMjU2IiBzdHlsZT0iZmlsbDogcmdiKDI0MCwgMjQwLCAyNDApOyI+PC9jaXJjbGU+PGc+PHBhdGggZD0iTTUyLjkyLDEwMC4xNDJjLTIwLjEwOSwyNi4xNjMtMzUuMjcyLDU2LjMxOC00NC4xMDEsODkuMDc3aDEzMy4xNzhMNTIuOTIsMTAwLjE0MnoiIHN0eWxlPSJmaWxsOiByZ2IoMCwgODIsIDE4MCk7Ij48L3BhdGg+PHBhdGggZD0iTTUwMy4xODEsMTg5LjIxOWMtOC44MjktMzIuNzU4LTIzLjk5My02Mi45MTMtNDQuMTAxLTg5LjA3NmwtODkuMDc1LDg5LjA3Nkg1MDMuMTgxeiIgc3R5bGU9ImZpbGw6IHJnYigwLCA4MiwgMTgwKTsiPjwvcGF0aD48cGF0aCBkPSJNOC44MTksMzIyLjc4NGM4LjgzLDMyLjc1OCwyMy45OTMsNjIuOTEzLDQ0LjEwMSw4OS4wNzVsODkuMDc0LTg5LjA3NUw4LjgxOSwzMjIuNzg0TDguODE5LDMyMi43ODR6IiBzdHlsZT0iZmlsbDogcmdiKDAsIDgyLCAxODApOyI+PC9wYXRoPjxwYXRoIGQ9Ik00MTEuODU4LDUyLjkyMWMtMjYuMTYzLTIwLjEwOS01Ni4zMTctMzUuMjcyLTg5LjA3Ni00NC4xMDJ2MTMzLjE3N0w0MTEuODU4LDUyLjkyMXoiIHN0eWxlPSJmaWxsOiByZ2IoMCwgODIsIDE4MCk7Ij48L3BhdGg+PHBhdGggZD0iTTEwMC4xNDIsNDU5LjA3OWMyNi4xNjMsMjAuMTA5LDU2LjMxOCwzNS4yNzIsODkuMDc2LDQ0LjEwMlYzNzAuMDA1TDEwMC4xNDIsNDU5LjA3OXoiIHN0eWxlPSJmaWxsOiByZ2IoMCwgODIsIDE4MCk7Ij48L3BhdGg+PHBhdGggZD0iTTE4OS4yMTcsOC44MTljLTMyLjc1OCw4LjgzLTYyLjkxMywyMy45OTMtODkuMDc1LDQ0LjEwMWw4OS4wNzUsODkuMDc1VjguODE5eiIgc3R5bGU9ImZpbGw6IHJnYigwLCA4MiwgMTgwKTsiPjwvcGF0aD48cGF0aCBkPSJNMzIyLjc4Myw1MDMuMTgxYzMyLjc1OC04LjgzLDYyLjkxMy0yMy45OTMsODkuMDc1LTQ0LjEwMWwtODkuMDc1LTg5LjA3NVY1MDMuMTgxeiIgc3R5bGU9ImZpbGw6IHJnYigwLCA4MiwgMTgwKTsiPjwvcGF0aD48cGF0aCBkPSJNMzcwLjAwNSwzMjIuNzg0bDg5LjA3NSw4OS4wNzZjMjAuMTA4LTI2LjE2MiwzNS4yNzItNTYuMzE4LDQ0LjEwMS04OS4wNzZIMzcwLjAwNXoiIHN0eWxlPSJmaWxsOiByZ2IoMCwgODIsIDE4MCk7Ij48L3BhdGg+PC9nPjxnPjxwYXRoIGQ9Ik01MDkuODMzLDIyMi42MDloLTIyMC40NGgtMC4wMDFWMi4xNjdDMjc4LjQ2MSwwLjc0NCwyNjcuMzE3LDAsMjU2LDBjLTExLjMxOSwwLTIyLjQ2MSwwLjc0NC0zMy4zOTEsMi4xNjd2MjIwLjQ0djAuMDAxSDIuMTY3QzAuNzQ0LDIzMy41MzksMCwyNDQuNjgzLDAsMjU2YzAsMTEuMzE5LDAuNzQ0LDIyLjQ2MSwyLjE2NywzMy4zOTFoMjIwLjQ0aDAuMDAxdjIyMC40NDJDMjMzLjUzOSw1MTEuMjU2LDI0NC42ODEsNTEyLDI1Niw1MTJjMTEuMzE3LDAsMjIuNDYxLTAuNzQzLDMzLjM5MS0yLjE2N3YtMjIwLjQ0di0wLjAwMWgyMjAuNDQyQzUxMS4yNTYsMjc4LjQ2MSw1MTIsMjY3LjMxOSw1MTIsMjU2QzUxMiwyNDQuNjgzLDUxMS4yNTYsMjMzLjUzOSw1MDkuODMzLDIyMi42MDl6IiBzdHlsZT0iZmlsbDogcmdiKDIxNiwgMCwgMzkpOyI+PC9wYXRoPjxwYXRoIGQ9Ik0zMjIuNzgzLDMyMi43ODRMMzIyLjc4MywzMjIuNzg0TDQzNy4wMTksNDM3LjAyYzUuMjU0LTUuMjUyLDEwLjI2Ni0xMC43NDMsMTUuMDQ4LTE2LjQzNWwtOTcuODAyLTk3LjgwMmgtMzEuNDgyVjMyMi43ODR6IiBzdHlsZT0iZmlsbDogcmdiKDIxNiwgMCwgMzkpOyI+PC9wYXRoPjxwYXRoIGQ9Ik0xODkuMjE3LDMyMi43ODRoLTAuMDAyTDc0Ljk4LDQzNy4wMTljNS4yNTIsNS4yNTQsMTAuNzQzLDEwLjI2NiwxNi40MzUsMTUuMDQ4bDk3LjgwMi05Ny44MDRWMzIyLjc4NHoiIHN0eWxlPSJmaWxsOiByZ2IoMjE2LCAwLCAzOSk7Ij48L3BhdGg+PHBhdGggZD0iTTE4OS4yMTcsMTg5LjIxOXYtMC4wMDJMNzQuOTgxLDc0Ljk4Yy01LjI1NCw1LjI1Mi0xMC4yNjYsMTAuNzQzLTE1LjA0OCwxNi40MzVsOTcuODAzLDk3LjgwM0gxODkuMjE3eiIgc3R5bGU9ImZpbGw6IHJnYigyMTYsIDAsIDM5KTsiPjwvcGF0aD48cGF0aCBkPSJNMzIyLjc4MywxODkuMjE5TDMyMi43ODMsMTg5LjIxOUw0MzcuMDIsNzQuOTgxYy01LjI1Mi01LjI1NC0xMC43NDMtMTAuMjY2LTE2LjQzNS0xNS4wNDdsLTk3LjgwMiw5Ny44MDNWMTg5LjIxOXoiIHN0eWxlPSJmaWxsOiByZ2IoMjE2LCAwLCAzOSk7Ij48L3BhdGg+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjwvc3ZnPg==',
    store: 'UK',
  },
  {
    name: 'EUROPE & UAE',
    domain: 'whitefoxboutique.co.uk',
    params: { currency: 'EUR' },
    icon: 'data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNjQgNjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIGFyaWEtaGlkZGVuPSJ0cnVlIiByb2xlPSJpbWciIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIG1lZXQiIGNsYXNzPSJpY29uaWZ5IGljb25pZnktLWVtb2ppb25lIj48Y2lyY2xlIGN4PSIzMiIgY3k9IjMyIiByPSIzMiIgZmlsbD0iIzJhNWY5ZSI+PC9jaXJjbGU+IDxnIGZpbGw9IiNmZmNlMzEiPjxwYXRoIGQ9Ik0zMiAxMS44bC43IDIuMkgzNWwtMS44IDEuNGwuNyAyLjJsLTEuOS0xLjRsLTEuOSAxLjRsLjctMi4yTDI5IDE0aDIuM3oiPjwvcGF0aD4gPHBhdGggZD0iTTMyIDQ1LjhsLjcgMi4ySDM1bC0xLjggMS4zbC43IDIuM2wtMS45LTEuNGwtMS45IDEuNGwuNy0yLjNMMjkgNDhoMi4zeiI+PC9wYXRoPiA8cGF0aCBkPSJNNDAuNCA0M2wuNyAyLjJoMi40bC0xLjkgMS40bC43IDIuMmwtMS45LTEuNGwtMS45IDEuNGwuOC0yLjJsLTEuOS0xLjRoMi4zeiI+PC9wYXRoPiA8cGF0aCBkPSJNNDYuMiAzNy4ybC43IDIuMmgyLjRsLTEuOSAxLjRsLjcgMi4ybC0xLjktMS40bC0xLjkgMS40bC44LTIuMmwtMS45LTEuNGgyLjN6Ij48L3BhdGg+IDxwYXRoIGQ9Ik00OSAyOC44bC43IDIuMkg1MmwtMS45IDEuNGwuNyAyLjJsLTEuOC0xLjRsLTEuOSAxLjRsLjctMi4ybC0xLjktMS40aDIuM3oiPjwvcGF0aD4gPHBhdGggZD0iTTQ2LjIgMjAuM2wuNyAyLjNoMi40bC0xLjkgMS4zbC43IDIuMmwtMS45LTEuM2wtMS45IDEuM2wuOC0yLjJsLTEuOS0xLjNoMi4zeiI+PC9wYXRoPiA8cGF0aCBkPSJNNDAuNCAxNC41bC43IDIuM2gyLjRsLTEuOSAxLjNsLjcgMi4ybC0xLjktMS4zbC0xLjkgMS4zbC44LTIuMmwtMS45LTEuM2gyLjN6Ij48L3BhdGg+IDxwYXRoIGQ9Ik0yMy42IDQzbC0uNyAyLjJoLTIuNGwxLjkgMS40bC0uNyAyLjJsMS45LTEuNGwxLjkgMS40bC0uOC0yLjJsMS45LTEuNGgtMi4zeiI+PC9wYXRoPiA8cGF0aCBkPSJNMTcuOCAzNy4ybC0uNyAyLjJoLTIuNGwxLjkgMS40bC0uNyAyLjJsMS45LTEuNGwxLjkgMS40bC0uOC0yLjJsMS45LTEuNGgtMi4zeiI+PC9wYXRoPiA8cGF0aCBkPSJNMTUgMjguOGwtLjcgMi4ySDEybDEuOSAxLjRsLS43IDIuMmwxLjgtMS40bDEuOSAxLjRsLS43LTIuMmwxLjktMS40aC0yLjN6Ij48L3BhdGg+IDxwYXRoIGQ9Ik0xNy44IDIwLjNsLS43IDIuM2gtMi40bDEuOSAxLjNsLS43IDIuMmwxLjktMS4zbDEuOSAxLjNsLS44LTIuMmwxLjktMS4zaC0yLjN6Ij48L3BhdGg+IDxwYXRoIGQ9Ik0yMy42IDE0LjVsLS43IDIuM2gtMi40bDEuOSAxLjNsLS43IDIuMmwxLjktMS4zbDEuOSAxLjNsLS44LTIuMmwxLjktMS4zaC0yLjN6Ij48L3BhdGg+PC9nPjwvc3ZnPg==',
    store: 'UK',
  },
  {
    name: 'REST OF THE WORLD',
    domain: 'whitefoxboutique.com.au',
    params: { currency: 'AUD' },
    icon: 'data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJDYXBhXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgNTExLjk5OSA1MTEuOTk5IiB4bWw6c3BhY2U9InByZXNlcnZlIj48Zz48cGF0aCBkPSJNNDQxLjM3NCw3OS41MTlsLTI2LjQ4NSwxNy42NTZsLTQ0LjE0MS04LjgyOGwtMjYuNDg1LTguODI4bC0zNS4zMTMsOC44MjhsLTI2LjQ4NS04LjgyOAoJCWwxNy42NTYtMzUuMzEzaDM1LjMxM2wzNC42MDctMTcuMzAzQzM5Ni43Myw0MC4xMDEsNDIwLjg3NSw1Ny45MTYsNDQxLjM3NCw3OS41MTl6IiBzdHlsZT0iZmlsbDogcmdiKDMsIDE3MCwgMTExKTsiPjwvcGF0aD4gPHBhdGggZD0iTTIzOC4zMjUsNDQuMjA2bC04LjgyOCwyNi40ODVsLTI2LjQ4NSw4LjgyOGwtMjYuNDg1LDQ0LjE0MWwtNDQuMTQxLDI2LjQ4NWwtNjEuNzk3LDguODI4djI2LjQ4NQoJCWwxNy42NTYsMTcuNjU2djM1LjMxM0w2MS43NjIsMjIwLjc3bC0yNi40ODUtMTcuNjU2bC0xNS4zNjEtNDYuMTcxQzQ2LjM1Niw5My45MzUsOTYuODk4LDQ0LjEyNiwxNjAuMjg0LDE4LjYwNGwyNS4wNzIsMTYuNzc0CgkJTDIzOC4zMjUsNDQuMjA2eiIgc3R5bGU9ImZpbGw6IHJnYigzLCAxNzAsIDExMSk7Ij48L3BhdGg+IDxwb2x5Z29uIHBvaW50cz0iMjU1Ljk4MiwyOTEuMzk1IDI0Ny4xNTQsMzM1LjUzNiAyMTEuODQxLDM3MC44NDkgMjExLjg0MSwzOTcuMzM0IDE3Ni41MjgsNDIzLjgxOCAKCQkxNzYuNTI4LDQ2Ny45NTkgMTUwLjA0NCw0NTkuMTMxIDEzMi4zODcsNDE0Ljk5IDEzMi4zODcsMzI2LjcwOCA4OC4yNDYsMzE3Ljg4IDcwLjU5LDI4Mi41NjcgNzAuNTksMjU2LjA4MiA4OC4yNDYsMjM4LjQyNiAKCQkxMTQuNzMxLDIxMS45NDEgMTMyLjM4NywyNDcuMjU0IDE5NC4xODQsMjQ3LjI1NCAyMjAuNjY5LDI5MS4zOTUgCSIgc3R5bGU9ImZpbGw6IHJnYigzLCAxNzAsIDExMSk7Ij48L3BvbHlnb24+IDxwYXRoIGQ9Ik00NzkuMzM1LDEzMC45ODdjNDguMTkzLDg1Ljk3OCw0Mi43MDIsMTkxLjk5Ni0xNC4xMjUsMjcyLjUyNmwtMjMuODM2LTIzLjgzNnYtMzUuMzEzCgkJbC0xNy42NTYtMzUuMzEzbC0xNy42NTYtMzUuMzEzdi0zNS4zMTNsLTI2LjQ4NS0xNy42NTZsLTM1LjMxMyw4LjgyOGwtNjEuNzk3LTI2LjQ4NWwtOC44MjgtNjEuNzk3bDI2LjQ4NS0yNi40ODVoNTIuOTY5CgkJbDE3LjY1NiwyNi40ODVsNTIuOTY5LDguODI4bDUyLjk2OS0xNy42NTZMNDc5LjMzNSwxMzAuOTg3eiIgc3R5bGU9ImZpbGw6IHJnYigzLCAxNzAsIDExMSk7Ij48L3BhdGg+PC9nPiA8cGF0aCBkPSJNMzA4Ljk1MSw4OC4zNDdsMzUuMzEzLTguODI4bDI2LjQ4NSw4LjgyOGw0NC4xNDEsOC44MjhsMjYuNDg1LTE3LjY1NgoJYzE0Ljc4NywxNS40NzYsMjcuNTQ0LDMyLjc3LDM3Ljk2MSw1MS40NjhsLTIuNjQ4LDEuNTAxbC01Mi45NjksMTcuNjU2bC01Mi45NjktOC44MjhsLTE3LjY1Ni0yNi40ODVoLTUyLjk2OWwtMjYuNDg1LDI2LjQ4NQoJbDguODI4LDYxLjc5N2w2MS43OTcsMjYuNDg1bDM1LjMxMy04LjgyOGwyNi40ODUsMTcuNjU2djM1LjMxM2wxNy42NTYsMzUuMzEzbDE3LjY1NiwzNS4zMTN2MzUuMzEzbDIzLjgzNiwyMy44MzYKCWMtODEuNTI4LDExNS41MjYtMjQxLjI3NSwxNDMuMDc5LTM1Ni43OTIsNjEuNTVDMTAuMzExLDM5NS44MTUtMjYuNDk0LDI2Ny42OTEsMTkuOTE2LDE1Ni45NDJsMTUuMzYxLDQ2LjE3MWwyNi40ODUsMTcuNjU2CglsMjYuNDg1LDE3LjY1Nkw3MC41OSwyNTYuMDgydjI2LjQ4NWwxNy42NTYsMzUuMzEzbDQ0LjE0MSw4LjgyOHY4OC4yODJsMTcuNjU2LDQ0LjE0MWwyNi40ODUsOC44Mjh2LTQ0LjE0MWwzNS4zMTMtMjYuNDg1di0yNi40ODUKCWwzNS4zMTMtMzUuMzEzbDguODI4LTQ0LjE0MWgtMzUuMzEzbC0yNi40ODUtNDQuMTQxaC02MS43OTdsLTE3LjY1Ni0zNS4zMTNsLTI2LjQ4NSwyNi40ODV2LTM1LjMxM0w3MC41OSwxODUuNDU3di0yNi40ODUKCWw2MS43OTctOC44MjhsNDQuMTQxLTI2LjQ4NWwyNi40ODUtNDQuMTQxbDI2LjQ4NS04LjgyOGw4LjgyOC0yNi40ODVsLTUyLjk2OS04LjgyOGwtMjUuMDcyLTE2Ljc3NAoJYzY3Ljg4OS0yNy4zNDEsMTQ0LjIzNS0yNC4zMjIsMjA5Ljc1OCw4LjI5OWwtMzQuNjA3LDE3LjMwM2gtMzUuMzEzbC0xNy42NTYsMzUuMzEzTDMwOC45NTEsODguMzQ3eiIgc3R5bGU9ImZpbGw6IHJnYigxMzQsIDIxOCwgMjQxKTsiPjwvcGF0aD4gPGc+PC9nPiA8Zz48L2c+IDxnPjwvZz4gPGc+PC9nPiA8Zz48L2c+IDxnPjwvZz4gPGc+PC9nPiA8Zz48L2c+IDxnPjwvZz4gPGc+PC9nPiA8Zz48L2c+IDxnPjwvZz4gPGc+PC9nPiA8Zz48L2c+IDxnPjwvZz48L3N2Zz4=',
    store: 'AU',
  },
];

// 1. Choose an extension target
export default reactExtension('purchase.checkout.footer.render-after', () => (
  <Extension />
));

function Extension() {

  const { query } = useApi();
  const cartLines = useCartLines();
  const [handles, setHandles] = useState([]);
  const [permalinkItems, setPermalinkItems] = useState([]);
  const { store: settingsStore, title } = useSettings();
  // const { store: settingsStore = 'AU', title = `Can't ship to your address? Switch to your region below:` } = useSettings(); // testing

  useEffect(() => {
    async function fetchStorefrontData() {
      const responses = await Promise.all(cartLines.map(l => query(
        `query ($productId: ID!) {
          product(id: $productId) {
            handle
          }
        }`,
        {
          variables: {
            productId: l.merchandise.product.id,
          },
        },
      )));

      const handles = responses.map(r => r?.data?.product?.handle);

      setHandles(handles);

      console.log('cartLines', cartLines);

      const cartPermalinkItems = cartLines.map((line, i) => {
        const { quantity, merchandise } = line;
        const { selectedOptions } = merchandise;
        const handle = handles[i];
        return {
          handle, 
          quantity,
          selectedOptions,
        };
      });

      setPermalinkItems(cartPermalinkItems);
    }

    if (cartLines.length > 0) {
      fetchStorefrontData();
    }
  }, [cartLines, query]);

   useEffect(() => {
    console.log('Updated handles:', handles, permalinkItems);
  }, [handles]); // This effect runs whenever handles changes

  const cartString = permalinkItems.map(({ handle, quantity, selectedOptions }) => `${ handle }:${ JSON.stringify(selectedOptions) }:${ quantity }`).join(',');
  const encodedCart = btoa(cartString);
  const permalinkParam = {
    permalink: encodedCart,
  };

  // atob(decodeURIComponent('dGhlLXZpZGVvZ3JhcGhlci1zbm93Ym9hcmQ6W3sibmFtZSI6IlRpdGxlIiwidmFsdWUiOiJEZWZhdWx0IFRpdGxlIn1dOjE%3D'));

  return (
    // <InlineLayout blockAlignment="center" spacing="base" columns={ SWITCHER_OPTIONS.length } minInlineSize="fill">
    <View padding={ ['loose', 'none'] }>
      { title && <Heading inlineAlignment="center">{ title }</Heading> }
      <InlineLayout spacing="loose" minBlockSize={ `${ 100 / SWITCHER_OPTIONS.length }%` } blockAlignment="start">
        { SWITCHER_OPTIONS.map(option => {
          const { name, domain, icon, store, params = {} } = option;
          const paramsWithCart = { ...params, ...permalinkParam };
          const url = `https://${ domain }?${ new URLSearchParams(paramsWithCart).toString() }`;

          const current = store === settingsStore;

          if (current) {
            return <View opacity="50">
              <BlockStack padding={ ['base', 'none'] } spacing="tight">
                <Image source={ icon }></Image>
                <TextBlock inlineAlignment="center" size="small" accessibilityRole="navigation" level="3">{ name }</TextBlock>
              </BlockStack>
            </View>;
          }

          return <Pressable to={ url }>
            <BlockStack padding={ ['base', 'none'] } spacing="tight">
              <Image source={ icon }></Image>
              <TextBlock inlineAlignment="center" size="small" accessibilityRole="navigation" level="3">{ name }</TextBlock>
            </BlockStack>
          </Pressable>;
        }) }
      </InlineLayout>
    </View>
  );
}